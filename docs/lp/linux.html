<!DOCTYPE html SYSTEM "about:legacy-compat"><html lang="en-US" data-colors-preset="vivid" data-primary-color="#24AFD0"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8">  <meta name="built-on" content="2023-08-14T00:22:22.741079"><meta name="build-number" content="${buildNumber}">       <title>Linux | openjdk-playground</title><script id="virtual-toc-data" type="application/json">[{"id":"command-line-tools","level":0,"title":"Command Line Tools","anchor":"#command-line-tools"},{"id":"proc-filesystem","level":0,"title":"Proc FileSystem","anchor":"#proc-filesystem"},{"id":"curl","level":0,"title":"Curl","anchor":"#curl"},{"id":"dig","level":0,"title":"DIG","anchor":"#dig"},{"id":"ssh","level":0,"title":"SSH","anchor":"#ssh"},{"id":"wireshark","level":0,"title":"Wireshark","anchor":"#wireshark"},{"id":"tcpdump","level":0,"title":"TCPDump","anchor":"#tcpdump"}]</script><script id="topic-shortcuts" type="application/json"></script><link href="https://resources.jetbrains.com/storage/writerside/v6.1.5/app.css" rel="stylesheet">   <link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><link rel="manifest" href="https://jetbrains.com/site.webmanifest"><link rel="mask-icon" href="https://jetbrains.com/safari-pinned-tab.svg" color="#000000"><meta name="msapplication-TileColor" content="#000000"/><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"/><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"/><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"/><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"/><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"/>  <meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Linux | openjdk-playground"/><meta property="og:description" content=""/><meta property="og:image" content=""/><meta property="og:site_name" content="openjdk-playground Help"/><meta property="og:type" content="website"/><meta property="og:locale" content="en_US"/><meta property="og:url" content="https://suresh.dev/openjdk-playground/lpopenjdk-playground/lplinux.html"/><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content="@sur3shg"><meta name="twitter:title" content="Linux | openjdk-playground"><meta name="twitter:description" content=""><meta name="twitter:creator" content="@sur3shg"><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json"> { "@context": "http://schema.org", "@type": "WebPage", "@id": "https://suresh.dev/openjdk-playground/lpopenjdk-playground/lplinux.html#webpage", "url": "https://suresh.dev/openjdk-playground/lpopenjdk-playground/lplinux.html", "name": "Linux | openjdk-playground", "description": "", "image": "", "inLanguage":"en-US" }</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json"> { "@type": "WebSite", "@id": "https://suresh.dev/openjdk-playground/lpopenjdk-playground/lp/#website", "url": "https://suresh.dev/openjdk-playground/lpopenjdk-playground/lp/", "name": "openjdk-playground Help" }</script><!-- End Schema.org --> <!-- Mermaid light/dark themes -->  <link rel="stylesheet" type="text/css" href="mermaid.css">  </head>     <body data-id="Linux" data-main-title="Linux" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}"  data-template="article"  data-breadcrumbs=""  >   <div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>openjdk-playground  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="Linux"  id="Linux.md"  >Linux</h1>  <ul class="list _ul" id="12600339_381"    ><li class="list__item" id="12600339_382"><p id="12600339_383"><span id="12600339_384" >Linux</span></p><ul class="list _ul" id="12600339_385"    ><li class="list__item" id="12600339_386"><p><a href="#command-line-tools" id="12600339_387" data-tooltip="Java Virtual Threads - c5m"  >Command Line Tools</a></p></li><li class="list__item" id="12600339_388"><p><a href="#proc-filesystem" id="12600339_389" data-tooltip="Checking the Init system"  >Proc FileSystem</a></p></li><li class="list__item" id="12600339_390"><p><a href="#curl" id="12600339_391" data-tooltip="Get round trip time"  >Curl</a></p></li><li class="list__item" id="12600339_392"><p><a href="#ssh" id="12600339_393" data-tooltip="Port Forwarding"  >SSH</a></p></li><li class="list__item" id="12600339_394"><p><a href="#wireshark" id="12600339_395" data-tooltip="Download wirkshark"  >Wireshark</a></p></li><li class="list__item" id="12600339_396"><p><a href="#tcpdump" id="12600339_397" data-tooltip="# HTTP traffic including req &amp; res headers and message body from a particular source. $ tcpdump -A -s 0 'src example.com and tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)' # All incoming HTTP GET traffic $ tcpdump -i any -s 0 -A&hellip;"  >TCPDump</a></p></li></ul></li></ul><section class="chapter"  ><h2 id="command-line-tools" data-toc="command-line-tools"   >Command Line Tools</h2><ul class="list _ul" id="12600339_398"    ><li class="list__item" id="12600339_399"><section class="chapter"  ><h3 id="process-threads-cpu-and-memory-usage" data-toc="process-threads-cpu-and-memory-usage"   >Process threads, cpu and memory usage.</h3><div class="code-block" data-lang="bash"         >
# Show process threads and it's CPU usage
$ ps  -p  &lt;pid&gt; \
      -T \
      -o start_time,uname,fname,pid,ppid,%cpu,%mem,tid,tname,thcount,time,size,rss,m_size,vsize,lwp | awk '{print $6}' | sort -rn | less

# OR
$ ps  -p  &lt;pid&gt; \
      -T \
      -o start_time,uname,fname,pid,ppid,%cpu,%mem,tid,tname,thcount,time,size,rss,m_size,vsize,lwp --sort -tid

# Show all processes sorted by RSS
$ ps -eo user,pid,pmem,rss,vsz,comm,start,time,command --sort -rss | numfmt --header --from-unit=1024 --to=iec --field 4-5 | awk '$3 != 0'

# Show process tree
$ pstree -aps

# Show all threads
$ ls /proc/&lt;pid&gt;/task

# Show all threads using top
$ top -H -p &lt;pid&gt;
</div></section></li><li class="list__item" id="12600339_401"><section class="chapter"  ><h3 id="sysctl" data-toc="sysctl"   >Sysctl</h3><div class="code-block" data-lang="bash"         >
# /etc/sysctl.conf
fs.file-max=10485760
fs.nr_open=10485760

net.core.somaxconn=16192
net.core.netdev_max_backlog=16192
net.ipv4.tcp_max_syn_backlog=16192

net.ipv4.ip_local_port_range = 1024 65535

net.core.rmem_max = 16777216
net.core.wmem_max = 16777216
net.core.rmem_default = 16777216
net.core.wmem_default = 16777216
net.ipv4.tcp_rmem = 4096 87380 16777216
net.ipv4.tcp_wmem = 4096 87380 16777216
net.ipv4.tcp_mem = 1638400 1638400 1638400

net.netfilter.nf_conntrack_buckets = 1966050
net.netfilter.nf_conntrack_max = 7864200

# EC2 Amazon Linux
net.core.netdev_max_backlog = 65536
net.core.optmem_max = 25165824
net.ipv4.tcp_max_tw_buckets = 1440000

# /etc/security/limits.conf (set max open file descriptors)
* soft nofile 8000000
* hard nofile 9000000
</div><ul class="list _ul" id="12600339_403"    ><li class="list__item" id="12600339_404"><p id="12600339_405"><a href="https://github.com/ebarlas/project-loom-c5m#experiments" id="12600339_406"   data-external="true" rel="noopener noreferrer" ><span class="control" id="12600339_407">Java Virtual Threads - c5m</span></a></p></li><li class="list__item" id="12600339_408"></li></ul><p id="12600339_409">See <a href="http://www.phoenixframework.org/blog/the-road-to-2-million-websocket-connections" id="12600339_410"   data-external="true" rel="noopener noreferrer" >2M websocket connections</a></p><ul class="list _ul" id="12600339_411"    ><li class="list__item" id="12600339_412"><p id="12600339_413">See <a href="https://www.linangran.com/?p=547" id="12600339_414"   data-external="true" rel="noopener noreferrer" >Tuning HA Proxy for 300K connections</a></p></li><li class="list__item" id="12600339_415"><p id="12600339_416">See <a href="https://tweaked.io/guide/kernel/" id="12600339_417"   data-external="true" rel="noopener noreferrer" >Kernel Tuning params</a></p></li><li class="list__item" id="12600339_418"></li></ul><p id="12600339_419">See <a href="http://veithen.github.io/2014/01/01/how-tcp-backlog-works-in-linux.html" id="12600339_420"   data-external="true" rel="noopener noreferrer" >How TCP backlog works in Linux</a></p><ul class="list _ul" id="12600339_421"    ><li class="list__item" id="12600339_422"><p>See <a href="http://www.fromdual.com/huge-amount-of-time-wait-connections" id="12600339_423"   data-external="true" rel="noopener noreferrer" >TCP TIME_WAIT config</a></p></li></ul><div class="code-block" data-lang="bash"         >
 # Can also set it using sysctl commands
 sysctl -w fs.file-max=12000500
 sysctl -w fs.nr_open=20000500
 sysctl -w net.ipv4.tcp_mem='10000000 10000000 10000000'
 sysctl -w net.ipv4.tcp_rmem='1024 4096 16384'
 sysctl -w net.ipv4.tcp_wmem='1024 4096 16384'
 sysctl -w net.core.rmem_max=16384
 sysctl -w net.core.wmem_max=16384
 sysctl -w net.core.somaxconn=1024
 ulimit -n 20000000
</div></section></li><li class="list__item" id="12600339_425"><p id="12600339_426">Netstat</p><div class="code-block" data-lang="bash"         >
# Find all TCP/UDP listening port's PID
$ netstat -tunalp

# On Mac
$ netstat -vanp tcp  | grep -i 8080

# Find process used by given port
$ lsof -i :8080

# Socket stats
$ ss -s
</div></li><li class="list__item" id="12600339_428"><p id="12600339_429">XArgs</p><div class="code-block" data-lang="bash"         >
sudo -S pgrep -f tomcat  | xargs -n 1  -I {}  sh -c 'echo &quot;Killing process pid: {}&quot; &amp;&amp;  sudo kill -9 {} &amp;&amp; echo Done.'
</div></li></ul></section><section class="chapter"  ><h2 id="proc-filesystem" data-toc="proc-filesystem"   >Proc FileSystem</h2><ul class="list _ul" id="12600339_431"    ><li class="list__item" id="12600339_432"><p id="12600339_433">Checking the Init system</p><div class="code-block" data-lang="bash"         >
case &quot;$(cat /proc/1/comm)&quot; in
    init)    echo Init ;;
    systemd) echo SystemD ;;
    upstart) echo Upstart ;;
    *) echo &quot;unknown: '`cat /proc/1/comm`'&quot; ;;
esac

# OR
$ ps --no-headers -o comm 1 | grep -q 'systemd'
</div></li></ul></section><section class="chapter"  ><h2 id="curl" data-toc="curl"   >Curl</h2><ul class="list _ul" id="12600339_435"    ><li class="list__item" id="12600339_436"><p id="12600339_437">Get round trip time</p><div class="code-block" data-lang="bash"         >
$ curl -X GET \
       -o /dev/null  \
       -I -w &quot;Connect: %{time_connect}s, Transfer: %{time_starttransfer}s, Total: %{time_total}s&quot; \
       -X GET http://www.google.com

# Curl Response time using specific DNS server
$  while true ;do curl \
      --dns-servers 8.8.8.8 \
      https://suresh.dev \
      -o /dev/null \
      -s \
      -w 'Total: %{time_total}s\n' \
;done
</div></li><li class="list__item" id="12600339_439"><p id="12600339_440">Download latest release from Github</p><div class="code-block" data-lang="bash"         >
# Download the latest release from Github
$ LOCATION=$(curl -s https://api.github.com/repos/jvm-profiling-tools/async-profiler/releases/latest \
    | grep -i &quot;browser_download_url&quot; \
    | grep -i &quot;converter.jar&quot; \
    | awk '{ print $2 }' \
    | sed 's/,$//'       \
    | sed 's/&quot;//g' )     \
    ; curl --progress-bar -L -o ${HOME}/install/tools/converter.jar ${LOCATION}
</div></li><li class="list__item" id="12600339_442"><p id="12600339_443">Download a file with retry</p><div class="code-block" data-lang="bash"         >
# -fsSLO
$ curl --fail \
      --silent \
      --show-error \
      --location \
      --remote-name \
      --compressed \
      --progress-bar \
      --retry 3 \
      --retry-connrefused \
      --retry-delay 1 \
      --connect-timeout 5 \
      --max-time 10 \
      --request GET \
https://search.maven.org/remotecontent?filepath=org/jetbrains/kotlin/kotlin-stdlib/1.7.0/kotlin-stdlib-1.7.0.jar
</div></li></ul></section><section class="chapter"  ><h2 id="dig" data-toc="dig"   >DIG</h2><ul class="list _ul" id="12600339_445"    ><li class="list__item" id="12600339_446"><p id="12600339_447">Commands</p><div class="code-block" data-lang="bash"         >
# Find all nameserver IPs for a TLD
$ for i in $(dig ns suresh.dev +short); do echo -n &quot;$i &quot; &amp;&amp; dig $i +short; done

# Trace DNS requests
$ dig +trace compute.suresh.dev

# Trace using specific resolver
$ dig @a.root-servers.net +trace compute.suresh.dev
</div></li></ul></section><section class="chapter"  ><h2 id="ssh" data-toc="ssh"   >SSH</h2><ul class="list _ul" id="12600339_449"    ><li class="list__item" id="12600339_450"><p id="12600339_451">Port Forwarding</p><div class="code-block" data-lang="bash"         >
# Local Port(2345) Forwarding
ssh -v user@ip -L 2345:ip:5432
# ssh -v ooadmin@100.64.0.32 -L 2345:100.64.0.32:5432

# Remote Port Forwarding
ssh -v  -R  :8091:localip:remoteport  user@remoteip
# ssh -v  -R  :8091:172.28.170.95:3000  app@10.242.182.199
</div></li></ul></section><section class="chapter"  ><h2 id="wireshark" data-toc="wireshark"   >Wireshark</h2><ul class="list _ul" id="12600339_453"    ><li class="list__item" id="12600339_454"><p id="12600339_455">Download <a href="https://www.wireshark.org/download.html" id="12600339_456"   data-external="true" rel="noopener noreferrer" >wirkshark</a></p></li><li class="list__item" id="12600339_457"><p id="12600339_458">Install <code class="code " id="12600339_459"  >tcpdump</code> on remote host (say <code class="code " id="12600339_460"  >10.9.210.101</code>)</p><div class="code-block" data-lang="bash"         >
$ ssh user@10.9.210.101 &quot;sudo yum install -y tcpdump&quot;
</div></li><li class="list__item" id="12600339_462"><p id="12600339_463">Start packet capture</p><div class="code-block" data-lang="bash"         >
$ ssh user@10.9.210.101 &quot;sudo /usr/sbin/tcpdump -s0 -w - 'port 22'&quot; | wireshark -k -i -
# or for 8080
$ ssh user@remote-host &quot;sudo /usr/sbin/tcpdump -s0 -w - 'port 8080'&quot; | wireshark -k -i -
</div><ul class="list _ul" id="12600339_465"    ><li class="list__item" id="12600339_466"><p>See <a href="https://kaischroed.wordpress.com/2013/01/28/howto-use-wireshark-over-ssh/" id="12600339_467"   data-external="true" rel="noopener noreferrer" >Wireshark Over SSH</a></p></li><li class="list__item" id="12600339_468"><p>See <a href="https://serverfault.com/a/530020/184962" id="12600339_469"   data-external="true" rel="noopener noreferrer" >Using Unix Named Pipe</a></p></li></ul></li></ul></section><section class="chapter"  ><h2 id="tcpdump" data-toc="tcpdump"   >TCPDump</h2><div class="code-block" data-lang="bash"         >
# HTTP traffic including req &amp; res headers and message body from a particular source.
$ tcpdump -A -s 0 'src example.com and tcp port 80 and (((ip[2:2] - ((ip[0]&amp;0xf)&lt;&lt;2)) - ((tcp[12]&amp;0xf0)&gt;&gt;2)) != 0)'

# All incoming HTTP GET traffic
$ tcpdump -i any -s 0 -A 'tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420'

# All incoming HTTP POST traffic to port 80
$ tcpdump -i any -s 0 -A 'tcp dst port 80 and tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504F5354'

# HTTP GET/POST  Incoming calls to port 80/443 Originating from 192.168.10.1 Host.
$ tcpdump -i any -s 0 -A 'tcp dst port 80 or tcp dst port 443 and tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x47455420 or tcp[((tcp[12:1] &amp; 0xf0) &gt;&gt; 2):4] = 0x504F5354' and host 192.168.10.1

# Filter HTTP User agents
$ tcpdump -vvAls0 | grep 'User-Agent:'

# Write to pcap file
$ tcpdump -i any -s 0 -X -w /tmp/tcpdump.pcap

# Capture TCP packets from local interface
$ tcpdump -i lo

# Print packet in ASCII
$ tcpdump -v -i lo -A
</div><ul class="list _ul" id="12600339_471"    ><li class="list__item" id="12600339_472"><p>https://danielmiessler.com/study/tcpdump/</p></li></ul></section><div class="last-modified"> Last modified: 14 August 2023</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom">  <a class="navigation-links__prev" href="jvm-profiling.html">JVM Profiling</a>   <a class="navigation-links__next" href="kotlin.html">Kotlin</a>  </div></article><div id="disqus_thread"></div></div></section></main></div>  <script src="https://resources.jetbrains.com/storage/writerside/v6.1.5/app.js"></script></body></html>